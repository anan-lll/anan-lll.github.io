import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.a4f2a176.js";const p="/assets/stickPicture1.abb8c0e8.png",C=JSON.parse('{"title":"playwright web自动化框架","description":"稳定性测试方案","frontmatter":{"title":"playwright web自动化框架","date":"2023-10-10T00:00:00.000Z","description":"稳定性测试方案","disabled":false,"readMins":20,"tags":["JavaScript"]},"headers":[],"relativePath":"blog/test/playwright web自动化框架.md","filePath":"blog/test/playwright web自动化框架.md"}'),o={name:"blog/test/playwright web自动化框架.md"},e=l(`<h1 id="playwright-web自动化框架" tabindex="-1">playwright web自动化框架 <a class="header-anchor" href="#playwright-web自动化框架" aria-label="Permalink to &quot;playwright web自动化框架&quot;">​</a></h1><h2 id="背景" tabindex="-1">背景 <a class="header-anchor" href="#背景" aria-label="Permalink to &quot;背景&quot;">​</a></h2><p>当前市场上UI自动化覆盖率最广的莫过于Selenium，而且Selenium上手很快，资料丰富，社区活跃。在发现Playwright之前，观远一直使用Selenium作为web自动化框架。但是我们在编写自动化用例的过程中还是发现了Selenium一些问题：</p><ul><li>依赖各种不同的driver，随着浏览器的不断更新，也需要不断的去维护这些driver</li><li>Selenium IDE录屏代码不稳定</li><li>稳定性不够好</li></ul><p>然后我们发现了Playwright，Playwright 是微软开源的Web自动化操作的框架，它的功能类似于 Selenium、Pyppeteer 等，都可以驱动浏览器进行各种自动化操作，对市面上的主流浏览器都提供了支持。API 功能简洁又强大，仅用一个API即可执行Chromium、Firefox、WebKit等主流浏览器自动化操作，并同时支持以无头模式、有头模式运行。 下面我们将对比Playwright和Selenium优缺点，以及分享我们基于Playwright所产生的一些经验。</p><h2 id="playwright和selenium对比" tabindex="-1">Playwright和Selenium对比 <a class="header-anchor" href="#playwright和selenium对比" aria-label="Permalink to &quot;Playwright和Selenium对比&quot;">​</a></h2><ul><li>支持语言(都支持主流语言)</li><li>Playwright：JavaScript &amp; TypeScript\\python\\C#\\Go\\Java</li><li>Selenium：java\\python\\ruby\\C#\\C++\\JavaScript</li><li>操作浏览器方式以及性能</li><li>Playwright：通过开发者工具与浏览器交互，安装简洁，不需要安装各种Driver，启动浏览器速度快</li><li>Selenium：需要通过各种WebDriver操作不同浏览器，启动浏览器速度慢</li><li>支持浏览器</li><li>Playwright：支持所有主流浏览器，Chromium/WebKit/Firefox，不支持IE11</li><li>Selenium：运行在目前所有主流浏览器上（不包括国内套皮的浏览器）</li><li>快速可靠执行</li><li>Playwright：自动等待(等待元素出现/等待事件发生)、基于Websocket（双向通讯）可自动获取浏览器实际情况。</li><li>Selenium：需要代码中加入等待，甚至元素状态轮训判断，增加运行时间、Selenium基于HTTP协议（单向通讯）</li><li>代码录屏</li><li>Playwright：可以使用基于css、xpath、text这些常用的元素定位方式进行录制生成代码，能大幅度的减少写代码的时间，同时代码稳定性也可以保证</li><li>Selenium：Selenium IDE录制的代码是基于coordinate 或者DOM 层级结构，所以极其不稳定，也就导致IDE基本无人问津</li><li>异步方式</li><li>Playwright支持异步方式</li><li>Selenium不支持异步方式</li><li>headless模式</li><li>Playwright和Selenium均支持headless模式，所以在Linux系统或缺少显示设备的场景下也可以跑UI自动化</li><li>移动端浏览器</li><li>Playwright和Selenium均支持移动端浏览器的模拟测试，不支持真机测试</li></ul><h2 id="playwright环境搭建" tabindex="-1">Playwright环境搭建 <a class="header-anchor" href="#playwright环境搭建" aria-label="Permalink to &quot;Playwright环境搭建&quot;">​</a></h2><h3 id="前置环境搭建" tabindex="-1">前置环境搭建 <a class="header-anchor" href="#前置环境搭建" aria-label="Permalink to &quot;前置环境搭建&quot;">​</a></h3><p>JDK 8、Git、Maven、TestNg、jUnit等</p><h3 id="pom-xml添加代码" tabindex="-1">pom.xml添加代码 <a class="header-anchor" href="#pom-xml添加代码" aria-label="Permalink to &quot;pom.xml添加代码&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">dependency</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">groupId</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">com.microsoft.playwright</span><span style="color:#F97583;">&lt;/</span><span style="color:#E1E4E8;">groupId</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">artifactId</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">playwright</span><span style="color:#F97583;">&lt;/</span><span style="color:#E1E4E8;">artifactId</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">version</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;">1.17</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">0</span><span style="color:#F97583;">&lt;/</span><span style="color:#E1E4E8;">version</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;/</span><span style="color:#E1E4E8;">dependency</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">dependency</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">groupId</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">com.microsoft.playwright</span><span style="color:#F97583;">&lt;/</span><span style="color:#E1E4E8;">groupId</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">artifactId</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">assertions</span><span style="color:#F97583;">&lt;/</span><span style="color:#E1E4E8;">artifactId</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">version</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;">1.17</span><span style="color:#E1E4E8;">.</span><span style="color:#FDAEB7;font-style:italic;">2</span><span style="color:#F97583;">&lt;/</span><span style="color:#E1E4E8;">version</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;/</span><span style="color:#E1E4E8;">dependency</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">dependency</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">groupId</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">com.microsoft.playwright</span><span style="color:#D73A49;">&lt;/</span><span style="color:#24292E;">groupId</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">artifactId</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">playwright</span><span style="color:#D73A49;">&lt;/</span><span style="color:#24292E;">artifactId</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">version</span><span style="color:#D73A49;">&gt;</span><span style="color:#005CC5;">1.17</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">0</span><span style="color:#D73A49;">&lt;/</span><span style="color:#24292E;">version</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;/</span><span style="color:#24292E;">dependency</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">dependency</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">groupId</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">com.microsoft.playwright</span><span style="color:#D73A49;">&lt;/</span><span style="color:#24292E;">groupId</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">artifactId</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">assertions</span><span style="color:#D73A49;">&lt;/</span><span style="color:#24292E;">artifactId</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">version</span><span style="color:#D73A49;">&gt;</span><span style="color:#005CC5;">1.17</span><span style="color:#24292E;">.</span><span style="color:#B31D28;font-style:italic;">2</span><span style="color:#D73A49;">&lt;/</span><span style="color:#24292E;">version</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;/</span><span style="color:#24292E;">dependency</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><h3 id="playwright依赖安装" tabindex="-1">Playwright依赖安装 <a class="header-anchor" href="#playwright依赖安装" aria-label="Permalink to &quot;Playwright依赖安装&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#首先安装可以支持的浏览器</span></span>
<span class="line"><span style="color:#B392F0;">mvn</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exec:java</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Dexec.mainClass=com.microsoft.playwright.CLI</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Dexec.args=</span><span style="color:#9ECBFF;">&quot;install&quot;</span></span>
<span class="line"><span style="color:#6A737D;">#如果有特殊浏览器需要安装可以先查看</span></span>
<span class="line"><span style="color:#B392F0;">mvn</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exec:java</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Dexec.mainClass=com.microsoft.playwright.CLI</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Dexec.args=</span><span style="color:#9ECBFF;">&quot;install --help&quot;</span></span>
<span class="line"><span style="color:#6A737D;">#安装特殊浏览器</span></span>
<span class="line"><span style="color:#B392F0;">Install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">WebKit</span></span>
<span class="line"><span style="color:#B392F0;">mvn</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exec:java</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Dexec.mainClass=com.microsoft.playwright.CLI</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Dexec.args=</span><span style="color:#9ECBFF;">&quot;install webkit&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#首先安装可以支持的浏览器</span></span>
<span class="line"><span style="color:#6F42C1;">mvn</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exec:java</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Dexec.mainClass=com.microsoft.playwright.CLI</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Dexec.args=</span><span style="color:#032F62;">&quot;install&quot;</span></span>
<span class="line"><span style="color:#6A737D;">#如果有特殊浏览器需要安装可以先查看</span></span>
<span class="line"><span style="color:#6F42C1;">mvn</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exec:java</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Dexec.mainClass=com.microsoft.playwright.CLI</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Dexec.args=</span><span style="color:#032F62;">&quot;install --help&quot;</span></span>
<span class="line"><span style="color:#6A737D;">#安装特殊浏览器</span></span>
<span class="line"><span style="color:#6F42C1;">Install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">WebKit</span></span>
<span class="line"><span style="color:#6F42C1;">mvn</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exec:java</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Dexec.mainClass=com.microsoft.playwright.CLI</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Dexec.args=</span><span style="color:#032F62;">&quot;install webkit&quot;</span></span></code></pre></div><h3 id="代码录制" tabindex="-1">代码录制 <a class="header-anchor" href="#代码录制" aria-label="Permalink to &quot;代码录制&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#打开浏览器进行录屏(保留已经验证的状态)</span></span>
<span class="line"><span style="color:#B392F0;">mvn</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exec:java</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Dexec.mainClass=com.microsoft.playwright.CLI</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Dexec.args=</span><span style="color:#9ECBFF;">&quot;codegen --load-storage=auth.json https://app.guandata.com&quot;</span></span>
<span class="line"><span style="color:#6A737D;">#如果要模仿手机操作，可以通过 playwright.devices 列表操作</span></span>
<span class="line"><span style="color:#B392F0;">Emulate</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">iPhone</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">.</span></span>
<span class="line"><span style="color:#B392F0;">mvn</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exec:java</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Dexec.mainClass=com.microsoft.playwright.CLI</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Dexec.args=</span><span style="color:#9ECBFF;">&#39;open --device=&quot;iPhone 11&quot; https://app.guandata.com&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#打开浏览器进行录屏(保留已经验证的状态)</span></span>
<span class="line"><span style="color:#6F42C1;">mvn</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exec:java</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Dexec.mainClass=com.microsoft.playwright.CLI</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Dexec.args=</span><span style="color:#032F62;">&quot;codegen --load-storage=auth.json https://app.guandata.com&quot;</span></span>
<span class="line"><span style="color:#6A737D;">#如果要模仿手机操作，可以通过 playwright.devices 列表操作</span></span>
<span class="line"><span style="color:#6F42C1;">Emulate</span><span style="color:#24292E;"> </span><span style="color:#032F62;">iPhone</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">.</span></span>
<span class="line"><span style="color:#6F42C1;">mvn</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exec:java</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Dexec.mainClass=com.microsoft.playwright.CLI</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Dexec.args=</span><span style="color:#032F62;">&#39;open --device=&quot;iPhone 11&quot; https://app.guandata.com&#39;</span></span></code></pre></div><h2 id="实用操作" tabindex="-1">实用操作 <a class="header-anchor" href="#实用操作" aria-label="Permalink to &quot;实用操作&quot;">​</a></h2><h3 id="录屏示例" tabindex="-1">录屏示例 <a class="header-anchor" href="#录屏示例" aria-label="Permalink to &quot;录屏示例&quot;">​</a></h3><p>使用playwright 针对固定场景进行录屏回放，观察录屏效果。 通过以下录屏过程和录屏代码可以看到：</p><ul><li>Playwright支持无头浏览器模式，且较为推荐（headless默认值为True）</li><li>可以使用传统定位方式（CSS，XPATH等），也有自定义的新的定位方式（如文字定位），元素定位和操作方法更加简单</li><li>操作方法中传入了元素定位，定位和操作同时进行(playwright也提供了单独的定位方法，作为可选) --selenium只能先定位元素，再进行操作</li><li>不需要为每个浏览器下载webdriver，可以随意切换不同浏览器</li><li>录屏方式简单</li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 输入账号密码登录系统</span></span>
<span class="line"><span style="color:#6A737D;">// 进入数据中心，新建一个test2名称的目录</span></span>
<span class="line"><span style="color:#E1E4E8;">public </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Example</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">String</span><span style="color:#E1E4E8;">[] </span><span style="color:#FFAB70;">args</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 实例化page对象</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> (Playwright playwright </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Playwright.</span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      Browser browser </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> playwright.</span><span style="color:#B392F0;">chromium</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">launch</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> BrowserType.</span><span style="color:#B392F0;">LaunchOptions</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">        .</span><span style="color:#B392F0;">setHeadless</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">      BrowserContext context </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> browser.</span><span style="color:#B392F0;">newContext</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> Browser.</span><span style="color:#B392F0;">NewContextOptions</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">        .</span><span style="color:#B392F0;">setStorageStatePath</span><span style="color:#E1E4E8;">(Paths.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;auth.json&quot;</span><span style="color:#E1E4E8;">)));</span></span>
<span class="line"><span style="color:#E1E4E8;">      Page page </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> context.</span><span style="color:#B392F0;">newPage</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 访问BI系统地址</span></span>
<span class="line"><span style="color:#E1E4E8;">      page.</span><span style="color:#B392F0;">navigate</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;http://192.168.199.6:8087/auth/index&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 输入域名、账号、密码进行登录</span></span>
<span class="line"><span style="color:#E1E4E8;">      page.</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;[placeholder=</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">公司域</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">]&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      page.</span><span style="color:#B392F0;">fill</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;[placeholder=</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">公司域</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">]&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;testing&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      page.</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;[placeholder=</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">邮箱地址</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">]&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      page.</span><span style="color:#B392F0;">fill</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;[placeholder=</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">邮箱地址</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">]&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;test@guandata.com&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      page.</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;[placeholder=</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">密码</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">]&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      page.</span><span style="color:#B392F0;">fill</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;[placeholder=</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">密码</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">]&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;123456&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      page.</span><span style="color:#B392F0;">waitForNavigation</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.press(</span><span style="color:#9ECBFF;">&quot;[placeholder=</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">密码</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">]&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;Enter&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      });</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 点击数据中心</span></span>
<span class="line"><span style="color:#E1E4E8;">      page.waitForNavigation(() -&gt; {</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.click(</span><span style="color:#9ECBFF;">&quot;#rc-tabs-0-tab-datacenter div:has-text(</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">数据中心</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">)&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      });</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 点击新建文件夹进行文件夹创建</span></span>
<span class="line"><span style="color:#E1E4E8;">      page.click(</span><span style="color:#9ECBFF;">&quot;button:has-text(</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">新建文件夹</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">)&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      page.fill(</span><span style="color:#9ECBFF;">&quot;text=文件夹名称文件夹位置:根目录 &gt;&gt; input[type=</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">text</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">]&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;test-playwright&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      page.click(</span><span style="color:#9ECBFF;">&quot;button:has-text(</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">确定</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">)&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 输入账号密码登录系统</span></span>
<span class="line"><span style="color:#6A737D;">// 进入数据中心，新建一个test2名称的目录</span></span>
<span class="line"><span style="color:#24292E;">public </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Example</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">(</span><span style="color:#E36209;">String</span><span style="color:#24292E;">[] </span><span style="color:#E36209;">args</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 实例化page对象</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> (Playwright playwright </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Playwright.</span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">      Browser browser </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> playwright.</span><span style="color:#6F42C1;">chromium</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">launch</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> BrowserType.</span><span style="color:#6F42C1;">LaunchOptions</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">        .</span><span style="color:#6F42C1;">setHeadless</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">false</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#24292E;">      BrowserContext context </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> browser.</span><span style="color:#6F42C1;">newContext</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> Browser.</span><span style="color:#6F42C1;">NewContextOptions</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">        .</span><span style="color:#6F42C1;">setStorageStatePath</span><span style="color:#24292E;">(Paths.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;auth.json&quot;</span><span style="color:#24292E;">)));</span></span>
<span class="line"><span style="color:#24292E;">      Page page </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> context.</span><span style="color:#6F42C1;">newPage</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 访问BI系统地址</span></span>
<span class="line"><span style="color:#24292E;">      page.</span><span style="color:#6F42C1;">navigate</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;http://192.168.199.6:8087/auth/index&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 输入域名、账号、密码进行登录</span></span>
<span class="line"><span style="color:#24292E;">      page.</span><span style="color:#6F42C1;">click</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;[placeholder=</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">公司域</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">]&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      page.</span><span style="color:#6F42C1;">fill</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;[placeholder=</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">公司域</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">]&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;testing&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      page.</span><span style="color:#6F42C1;">click</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;[placeholder=</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">邮箱地址</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">]&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      page.</span><span style="color:#6F42C1;">fill</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;[placeholder=</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">邮箱地址</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">]&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;test@guandata.com&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      page.</span><span style="color:#6F42C1;">click</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;[placeholder=</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">密码</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">]&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      page.</span><span style="color:#6F42C1;">fill</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;[placeholder=</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">密码</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">]&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;123456&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      page.</span><span style="color:#6F42C1;">waitForNavigation</span><span style="color:#24292E;">(() </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        page.press(</span><span style="color:#032F62;">&quot;[placeholder=</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">密码</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">]&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;Enter&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      });</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 点击数据中心</span></span>
<span class="line"><span style="color:#24292E;">      page.waitForNavigation(() -&gt; {</span></span>
<span class="line"><span style="color:#24292E;">        page.click(</span><span style="color:#032F62;">&quot;#rc-tabs-0-tab-datacenter div:has-text(</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">数据中心</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">)&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      });</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 点击新建文件夹进行文件夹创建</span></span>
<span class="line"><span style="color:#24292E;">      page.click(</span><span style="color:#032F62;">&quot;button:has-text(</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">新建文件夹</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">)&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      page.fill(</span><span style="color:#032F62;">&quot;text=文件夹名称文件夹位置:根目录 &gt;&gt; input[type=</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">text</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">]&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;test-playwright&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      page.click(</span><span style="color:#032F62;">&quot;button:has-text(</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">确定</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">)&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h3 id="切换浏览器以及headless设置" tabindex="-1">切换浏览器以及headless设置 <a class="header-anchor" href="#切换浏览器以及headless设置" aria-label="Permalink to &quot;切换浏览器以及headless设置&quot;">​</a></h3><ul><li>Playwright支持切换不同的浏览器，在实际的自动化过程中可以进行多个浏览器的兼容性测试。</li><li>日常自动化用例执行可以采用headless模式(无头模式，浏览器不会打开界面)，提升用例执行效率。而当我们进行用例开发的时候，使用无headless模式方便代码调试(有头模式，浏览器会打开界面)，提升用例编写效率。</li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 使用此Browser 对象，可以使用launch()方法启动浏览器实例</span></span>
<span class="line"><span style="color:#E1E4E8;">Playwright playwright </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Playwright.</span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#6A737D;">// 使用firefox浏览器，也可以改为webkit浏览器</span></span>
<span class="line"><span style="color:#E1E4E8;">Browser browser </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> playwright.</span><span style="color:#B392F0;">firefox</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">launch</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#6A737D;">// false为有头模式(有界面的浏览器)，true为无头模式(没有界面的浏览器)</span></span>
<span class="line"><span style="color:#E1E4E8;">Browser browser </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">  playwright.</span><span style="color:#B392F0;">chromium</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">launch</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> BrowserType.</span><span style="color:#B392F0;">LaunchOptions</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">setHeadless</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">));</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 使用此Browser 对象，可以使用launch()方法启动浏览器实例</span></span>
<span class="line"><span style="color:#24292E;">Playwright playwright </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Playwright.</span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#6A737D;">// 使用firefox浏览器，也可以改为webkit浏览器</span></span>
<span class="line"><span style="color:#24292E;">Browser browser </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> playwright.</span><span style="color:#6F42C1;">firefox</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">launch</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#6A737D;">// false为有头模式(有界面的浏览器)，true为无头模式(没有界面的浏览器)</span></span>
<span class="line"><span style="color:#24292E;">Browser browser </span><span style="color:#D73A49;">=</span><span style="color:#24292E;">  playwright.</span><span style="color:#6F42C1;">chromium</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">launch</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> BrowserType.</span><span style="color:#6F42C1;">LaunchOptions</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">setHeadless</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">false</span><span style="color:#24292E;">));</span></span></code></pre></div><h3 id="封装父类方法" tabindex="-1">封装父类方法 <a class="header-anchor" href="#封装父类方法" aria-label="Permalink to &quot;封装父类方法&quot;">​</a></h3><p>把共用的方法封装在父类中：浏览器默认为chromium、headless模式、设置浏览器宽和高、环境的默认地址等。 测试类中引用这个父类后，在执行测试用例时会先触发父类中的操作，避免代码重复编写。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">public </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">UiAbstract</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> Page </span><span style="color:#FFAB70;">page</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> BrowserContext </span><span style="color:#FFAB70;">context</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    @BeforeSuite</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">setUp</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        Playwright playwright </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Playwright.</span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">//设置浏览器为chromium，headless模式</span></span>
<span class="line"><span style="color:#E1E4E8;">        Browser browser </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> playwright.</span><span style="color:#B392F0;">chromium</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">launch</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> BrowserType.</span><span style="color:#B392F0;">LaunchOptions</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">setHeadless</span><span style="color:#E1E4E8;">(Env.</span><span style="color:#79B8FF;">HEADLESS</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">        Browser.NewContextOptions contextOptions </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> Browser.</span><span style="color:#B392F0;">NewContextOptions</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 设置浏览器宽和高</span></span>
<span class="line"><span style="color:#E1E4E8;">        contextOptions.</span><span style="color:#B392F0;">setViewportSize</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1280</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">720</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">//设置环境的默认地址</span></span>
<span class="line"><span style="color:#E1E4E8;">        contextOptions.</span><span style="color:#B392F0;">setBaseURL</span><span style="color:#E1E4E8;">(Env.</span><span style="color:#79B8FF;">TESTSERVER</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        context </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> browser.</span><span style="color:#B392F0;">newContext</span><span style="color:#E1E4E8;">(contextOptions);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">public </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UiAbstract</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> Page </span><span style="color:#E36209;">page</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> BrowserContext </span><span style="color:#E36209;">context</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    @BeforeSuite</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">setUp</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        Playwright playwright </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Playwright.</span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">//设置浏览器为chromium，headless模式</span></span>
<span class="line"><span style="color:#24292E;">        Browser browser </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> playwright.</span><span style="color:#6F42C1;">chromium</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">launch</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> BrowserType.</span><span style="color:#6F42C1;">LaunchOptions</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">setHeadless</span><span style="color:#24292E;">(Env.</span><span style="color:#005CC5;">HEADLESS</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#24292E;">        Browser.NewContextOptions contextOptions </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> Browser.</span><span style="color:#6F42C1;">NewContextOptions</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 设置浏览器宽和高</span></span>
<span class="line"><span style="color:#24292E;">        contextOptions.</span><span style="color:#6F42C1;">setViewportSize</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1280</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">720</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">//设置环境的默认地址</span></span>
<span class="line"><span style="color:#24292E;">        contextOptions.</span><span style="color:#6F42C1;">setBaseURL</span><span style="color:#24292E;">(Env.</span><span style="color:#005CC5;">TESTSERVER</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        context </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> browser.</span><span style="color:#6F42C1;">newContext</span><span style="color:#24292E;">(contextOptions);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h3 id="常用断言方法" tabindex="-1">常用断言方法 <a class="header-anchor" href="#常用断言方法" aria-label="Permalink to &quot;常用断言方法&quot;">​</a></h3><p>介绍一些常用的UI自动化断言的方法，观远中使用最多的是截图对比断言，详见4.5</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">String content </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">text_content</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;:nth-match(i, 2)&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">Assert.</span><span style="color:#B392F0;">assertEquals</span><span style="color:#E1E4E8;">(content, expected, </span><span style="color:#9ECBFF;">&quot;[&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> description </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;]测试案例失败！&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 等待元素出现</span></span>
<span class="line"><span style="color:#E1E4E8;">page.</span><span style="color:#B392F0;">waitForSelector</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;:nth-match(i, 2)&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#6A737D;">// 获取文本内容，进行断言</span></span>
<span class="line"><span style="color:#E1E4E8;">String content </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">text_content</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;:nth-match(i, 2)&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">Assert.</span><span style="color:#B392F0;">assertEquals</span><span style="color:#E1E4E8;">(content, expected, </span><span style="color:#9ECBFF;">&quot;[&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> description </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;]测试案例失败！&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">String text </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">inner_text</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;:nth-match(i, 2)&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">Assert.</span><span style="color:#B392F0;">assertEquals</span><span style="color:#E1E4E8;">(text, expected, </span><span style="color:#9ECBFF;">&quot;[&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> description </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;]测试案例失败！&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">String attribute </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">getAttribute</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;#su&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;value&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">Assert.</span><span style="color:#B392F0;">assertEquals</span><span style="color:#E1E4E8;">(attribute, expected, </span><span style="color:#9ECBFF;">&quot;[&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> description </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;]测试案例失败！&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">boolean visible </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">isVisible</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;#su&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">Assert.</span><span style="color:#B392F0;">assertTrue</span><span style="color:#E1E4E8;">(visible, expected, description);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">boolean enabled </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">isEnabled</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;#su&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">Assert.</span><span style="color:#B392F0;">assertTrue</span><span style="color:#E1E4E8;">(visible, expected, description);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">String title </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">title</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">Assert.</span><span style="color:#B392F0;">assertEquals</span><span style="color:#E1E4E8;">(title, expected, </span><span style="color:#9ECBFF;">&quot;[&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> description </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;]测试案例失败！&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">String url </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">url</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">Assert.</span><span style="color:#B392F0;">assertEquals</span><span style="color:#E1E4E8;">(url, expected, </span><span style="color:#9ECBFF;">&quot;[&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> description </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;]测试案例失败！&quot;</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">String content </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> page.</span><span style="color:#6F42C1;">text_content</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;:nth-match(i, 2)&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">Assert.</span><span style="color:#6F42C1;">assertEquals</span><span style="color:#24292E;">(content, expected, </span><span style="color:#032F62;">&quot;[&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> description </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;]测试案例失败！&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 等待元素出现</span></span>
<span class="line"><span style="color:#24292E;">page.</span><span style="color:#6F42C1;">waitForSelector</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;:nth-match(i, 2)&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#6A737D;">// 获取文本内容，进行断言</span></span>
<span class="line"><span style="color:#24292E;">String content </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> page.</span><span style="color:#6F42C1;">text_content</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;:nth-match(i, 2)&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">Assert.</span><span style="color:#6F42C1;">assertEquals</span><span style="color:#24292E;">(content, expected, </span><span style="color:#032F62;">&quot;[&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> description </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;]测试案例失败！&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">String text </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> page.</span><span style="color:#6F42C1;">inner_text</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;:nth-match(i, 2)&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">Assert.</span><span style="color:#6F42C1;">assertEquals</span><span style="color:#24292E;">(text, expected, </span><span style="color:#032F62;">&quot;[&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> description </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;]测试案例失败！&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">String attribute </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> page.</span><span style="color:#6F42C1;">getAttribute</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;#su&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;value&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">Assert.</span><span style="color:#6F42C1;">assertEquals</span><span style="color:#24292E;">(attribute, expected, </span><span style="color:#032F62;">&quot;[&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> description </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;]测试案例失败！&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">boolean visible </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> page.</span><span style="color:#6F42C1;">isVisible</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;#su&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">Assert.</span><span style="color:#6F42C1;">assertTrue</span><span style="color:#24292E;">(visible, expected, description);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">boolean enabled </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> page.</span><span style="color:#6F42C1;">isEnabled</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;#su&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">Assert.</span><span style="color:#6F42C1;">assertTrue</span><span style="color:#24292E;">(visible, expected, description);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">String title </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> page.</span><span style="color:#6F42C1;">title</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">Assert.</span><span style="color:#6F42C1;">assertEquals</span><span style="color:#24292E;">(title, expected, </span><span style="color:#032F62;">&quot;[&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> description </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;]测试案例失败！&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">String url </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> page.</span><span style="color:#6F42C1;">url</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">Assert.</span><span style="color:#6F42C1;">assertEquals</span><span style="color:#24292E;">(url, expected, </span><span style="color:#032F62;">&quot;[&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> description </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;]测试案例失败！&quot;</span><span style="color:#24292E;">);</span></span></code></pre></div><h3 id="截图对比断言" tabindex="-1">截图对比断言 <a class="header-anchor" href="#截图对比断言" aria-label="Permalink to &quot;截图对比断言&quot;">​</a></h3><p>由于通过文本方式进行断言工作量也是非常大的，固通过二次开发增加截图与base进行像素对比进行断言，提高UI自动化编写效率。 主要流程：</p><ul><li>1.编写用例时，把需要断言的页面进行截图，图片上传到Samba服务器相应的路径下</li><li>2.测试类中引用截图断言方法(可以通过元素定位截图，也可以全屏幕进行截图)，并设置像素相似度(0-1之间)，生成的截图结果会放到Samba服务器对应路径下</li><li>3.截图断言方法会针对两张图片进行像素比对，会在一张空白图片中画上对比结果，对比成功的画入灰色，对比失败的画入红色</li><li>4.生成测试报告，报告中含有实际截图、期望截图、对比截图，如下图</li><li>5.如果是前端正常修改导致的断言失败，通过开发的小工具把实际截图替换期望截图</li></ul><p><img src="`+p+`" alt="这是图片" title="Magic Gardens"> 截图断言核心代码如下：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">public </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ImageDiff</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> double </span><span style="color:#B392F0;">getDifferencePercent</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">String</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">actual</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">String</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">baseline</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">String</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">diffOut</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">threshold</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">double</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">tolerance</span><span style="color:#E1E4E8;">) throws IOException {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 读取实际图片和base图片的图像</span></span>
<span class="line"><span style="color:#E1E4E8;">        InputStream actualInputStream </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">FileInputStream</span><span style="color:#E1E4E8;">(actual);</span></span>
<span class="line"><span style="color:#E1E4E8;">        InputStream baseInputStream </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">FileInputStream</span><span style="color:#E1E4E8;">(baseline);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            BufferedImage img1 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ImageIO.</span><span style="color:#B392F0;">read</span><span style="color:#E1E4E8;">(actualInputStream);</span></span>
<span class="line"><span style="color:#E1E4E8;">            BufferedImage img2 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ImageIO.</span><span style="color:#B392F0;">read</span><span style="color:#E1E4E8;">(baseInputStream);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 获取图片的高和宽</span></span>
<span class="line"><span style="color:#E1E4E8;">            int width </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> img1.</span><span style="color:#B392F0;">getWidth</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">            int height </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> img1.</span><span style="color:#B392F0;">getHeight</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">            int width2 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> img2.</span><span style="color:#B392F0;">getWidth</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">            int height2 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> img2.</span><span style="color:#B392F0;">getHeight</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">            long diffCount </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 遍历屏幕截图像素点数据</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (int y </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; y </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> height; y</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (int x </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; x </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> width; x</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#6A737D;">//使用getRGB(w, h)获取该点的颜色值是ARGB</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#6A737D;">//而在实际应用中使用的是RGB，所以需要将ARGB转化成RGB，即bufImg.getRGB(w, h) &amp; 0xFFFFFF。</span></span>
<span class="line"><span style="color:#E1E4E8;">                    int i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pixelYIQDiff</span><span style="color:#E1E4E8;">(img1.</span><span style="color:#B392F0;">getRGB</span><span style="color:#E1E4E8;">(x, y), img2.</span><span style="color:#B392F0;">getRGB</span><span style="color:#E1E4E8;">(x, y));</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (i </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> threshold) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        diffCount</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                        img1.</span><span style="color:#B392F0;">setRGB</span><span style="color:#E1E4E8;">(x, y, </span><span style="color:#79B8FF;">0xffff0000</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">                    } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        img1.</span><span style="color:#B392F0;">setRGB</span><span style="color:#E1E4E8;">(x, y, </span><span style="color:#B392F0;">greyPixel</span><span style="color:#E1E4E8;">(img1.</span><span style="color:#B392F0;">getRGB</span><span style="color:#E1E4E8;">(x, y)));</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            long maxDiffCount </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> width </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> height;</span></span>
<span class="line"><span style="color:#E1E4E8;">            double diffPct </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> diffCount </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> maxDiffCount;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 不一致的图片大于精度，则使用图片标出</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (diffPct </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> tolerance) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                ImageIO.</span><span style="color:#B392F0;">write</span><span style="color:#E1E4E8;">(img1, </span><span style="color:#9ECBFF;">&quot;png&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">File</span><span style="color:#E1E4E8;">(diffOut));</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> diffPct;</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (FileNotFoundException e) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            Log.</span><span style="color:#B392F0;">warn</span><span style="color:#E1E4E8;">(baseline </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;文件不存在&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            DistributeController.</span><span style="color:#B392F0;">uploadFile</span><span style="color:#E1E4E8;">(baseline, actualInputStream);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">//            FileUtils.copyFile(actualFile, baselineFile);</span></span>
<span class="line"><span style="color:#E1E4E8;">            e.</span><span style="color:#B392F0;">printStackTrace</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 分别获取出rgb中的r、g、b的值，并得到不一致数</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> int </span><span style="color:#B392F0;">pixelYIQDiff</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">rgb1</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">rgb2</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// 对整数直接进行计算得到rgb值</span></span>
<span class="line"><span style="color:#E1E4E8;">        int r1 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (rgb1 </span><span style="color:#F97583;">&gt;&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xff</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        int g1 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (rgb1 </span><span style="color:#F97583;">&gt;&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xff</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        int b1 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> rgb1 </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xff</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        int r2 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (rgb2 </span><span style="color:#F97583;">&gt;&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xff</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        int g2 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (rgb2 </span><span style="color:#F97583;">&gt;&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xff</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        int b2 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> rgb2 </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xff</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        double yDiff </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">rgb2y</span><span style="color:#E1E4E8;">(r1, g1, b1) </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">rgb2y</span><span style="color:#E1E4E8;">(r2, g2, b2);</span></span>
<span class="line"><span style="color:#E1E4E8;">        double iDiff </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">rgb2i</span><span style="color:#E1E4E8;">(r1, g1, b1) </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">rgb2i</span><span style="color:#E1E4E8;">(r2, g2, b2);</span></span>
<span class="line"><span style="color:#E1E4E8;">        double qDiff </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">rgb2q</span><span style="color:#E1E4E8;">(r1, g1, b1) </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">rgb2q</span><span style="color:#E1E4E8;">(r2, g2, b2);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> (int) (</span><span style="color:#79B8FF;">0.5053</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> yDiff </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> yDiff </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.299</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> iDiff </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> iDiff </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.1957</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> qDiff </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> qDiff);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> double </span><span style="color:#B392F0;">rgb2y</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">r</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">g</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">b</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> r </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.29889531</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> g </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.58662247</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> b </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.11448223</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> double </span><span style="color:#B392F0;">rgb2i</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">r</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">g</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">b</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> r </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.59597799</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> g </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.27417610</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> b </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.32180189</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> double </span><span style="color:#B392F0;">rgb2q</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">r</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">g</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">b</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> r </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.21147017</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> g </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.52261711</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> b </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.31114694</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 像素匹配上绘制灰色</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> int </span><span style="color:#B392F0;">greyPixel</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">rgb1</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 对整数直接进行计算得到rgb值</span></span>
<span class="line"><span style="color:#E1E4E8;">        int r1 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (rgb1 </span><span style="color:#F97583;">&gt;&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xff</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        int g1 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (rgb1 </span><span style="color:#F97583;">&gt;&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xff</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        int b1 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> rgb1 </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xff</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        int y </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (int) </span><span style="color:#B392F0;">rgb2y</span><span style="color:#E1E4E8;">(r1, g1, b1);</span></span>
<span class="line"><span style="color:#E1E4E8;">        int gray </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (int) (</span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> (y </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.2</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> gray </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x00ff0000</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> gray </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x0000ff00</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> gray </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x000000ff</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xff000000</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#24292E;">public </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ImageDiff</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> double </span><span style="color:#6F42C1;">getDifferencePercent</span><span style="color:#24292E;">(</span><span style="color:#E36209;">String</span><span style="color:#24292E;"> </span><span style="color:#E36209;">actual</span><span style="color:#24292E;">, </span><span style="color:#E36209;">String</span><span style="color:#24292E;"> </span><span style="color:#E36209;">baseline</span><span style="color:#24292E;">, </span><span style="color:#E36209;">String</span><span style="color:#24292E;"> </span><span style="color:#E36209;">diffOut</span><span style="color:#24292E;">, </span><span style="color:#E36209;">int</span><span style="color:#24292E;"> </span><span style="color:#E36209;">threshold</span><span style="color:#24292E;">, </span><span style="color:#E36209;">double</span><span style="color:#24292E;"> </span><span style="color:#E36209;">tolerance</span><span style="color:#24292E;">) throws IOException {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 读取实际图片和base图片的图像</span></span>
<span class="line"><span style="color:#24292E;">        InputStream actualInputStream </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">FileInputStream</span><span style="color:#24292E;">(actual);</span></span>
<span class="line"><span style="color:#24292E;">        InputStream baseInputStream </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">FileInputStream</span><span style="color:#24292E;">(baseline);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            BufferedImage img1 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ImageIO.</span><span style="color:#6F42C1;">read</span><span style="color:#24292E;">(actualInputStream);</span></span>
<span class="line"><span style="color:#24292E;">            BufferedImage img2 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ImageIO.</span><span style="color:#6F42C1;">read</span><span style="color:#24292E;">(baseInputStream);</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 获取图片的高和宽</span></span>
<span class="line"><span style="color:#24292E;">            int width </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> img1.</span><span style="color:#6F42C1;">getWidth</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            int height </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> img1.</span><span style="color:#6F42C1;">getHeight</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            int width2 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> img2.</span><span style="color:#6F42C1;">getWidth</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            int height2 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> img2.</span><span style="color:#6F42C1;">getHeight</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            long diffCount </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 遍历屏幕截图像素点数据</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (int y </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; y </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> height; y</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (int x </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; x </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> width; x</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6A737D;">//使用getRGB(w, h)获取该点的颜色值是ARGB</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6A737D;">//而在实际应用中使用的是RGB，所以需要将ARGB转化成RGB，即bufImg.getRGB(w, h) &amp; 0xFFFFFF。</span></span>
<span class="line"><span style="color:#24292E;">                    int i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pixelYIQDiff</span><span style="color:#24292E;">(img1.</span><span style="color:#6F42C1;">getRGB</span><span style="color:#24292E;">(x, y), img2.</span><span style="color:#6F42C1;">getRGB</span><span style="color:#24292E;">(x, y));</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (i </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> threshold) {</span></span>
<span class="line"><span style="color:#24292E;">                        diffCount</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">                        img1.</span><span style="color:#6F42C1;">setRGB</span><span style="color:#24292E;">(x, y, </span><span style="color:#005CC5;">0xffff0000</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">                    } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                        img1.</span><span style="color:#6F42C1;">setRGB</span><span style="color:#24292E;">(x, y, </span><span style="color:#6F42C1;">greyPixel</span><span style="color:#24292E;">(img1.</span><span style="color:#6F42C1;">getRGB</span><span style="color:#24292E;">(x, y)));</span></span>
<span class="line"><span style="color:#24292E;">                    }</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            long maxDiffCount </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> width </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> height;</span></span>
<span class="line"><span style="color:#24292E;">            double diffPct </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> diffCount </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> maxDiffCount;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 不一致的图片大于精度，则使用图片标出</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (diffPct </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> tolerance) {</span></span>
<span class="line"><span style="color:#24292E;">                ImageIO.</span><span style="color:#6F42C1;">write</span><span style="color:#24292E;">(img1, </span><span style="color:#032F62;">&quot;png&quot;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">File</span><span style="color:#24292E;">(diffOut));</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> diffPct;</span></span>
<span class="line"><span style="color:#24292E;">        } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (FileNotFoundException e) {</span></span>
<span class="line"><span style="color:#24292E;">            Log.</span><span style="color:#6F42C1;">warn</span><span style="color:#24292E;">(baseline </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;文件不存在&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">            DistributeController.</span><span style="color:#6F42C1;">uploadFile</span><span style="color:#24292E;">(baseline, actualInputStream);</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">//            FileUtils.copyFile(actualFile, baselineFile);</span></span>
<span class="line"><span style="color:#24292E;">            e.</span><span style="color:#6F42C1;">printStackTrace</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 分别获取出rgb中的r、g、b的值，并得到不一致数</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> int </span><span style="color:#6F42C1;">pixelYIQDiff</span><span style="color:#24292E;">(</span><span style="color:#E36209;">int</span><span style="color:#24292E;"> </span><span style="color:#E36209;">rgb1</span><span style="color:#24292E;">, </span><span style="color:#E36209;">int</span><span style="color:#24292E;"> </span><span style="color:#E36209;">rgb2</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// 对整数直接进行计算得到rgb值</span></span>
<span class="line"><span style="color:#24292E;">        int r1 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (rgb1 </span><span style="color:#D73A49;">&gt;&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0xff</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        int g1 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (rgb1 </span><span style="color:#D73A49;">&gt;&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0xff</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        int b1 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> rgb1 </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0xff</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        int r2 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (rgb2 </span><span style="color:#D73A49;">&gt;&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0xff</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        int g2 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (rgb2 </span><span style="color:#D73A49;">&gt;&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0xff</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        int b2 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> rgb2 </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0xff</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        double yDiff </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">rgb2y</span><span style="color:#24292E;">(r1, g1, b1) </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">rgb2y</span><span style="color:#24292E;">(r2, g2, b2);</span></span>
<span class="line"><span style="color:#24292E;">        double iDiff </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">rgb2i</span><span style="color:#24292E;">(r1, g1, b1) </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">rgb2i</span><span style="color:#24292E;">(r2, g2, b2);</span></span>
<span class="line"><span style="color:#24292E;">        double qDiff </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">rgb2q</span><span style="color:#24292E;">(r1, g1, b1) </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">rgb2q</span><span style="color:#24292E;">(r2, g2, b2);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> (int) (</span><span style="color:#005CC5;">0.5053</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> yDiff </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> yDiff </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.299</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> iDiff </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> iDiff </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.1957</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> qDiff </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> qDiff);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> double </span><span style="color:#6F42C1;">rgb2y</span><span style="color:#24292E;">(</span><span style="color:#E36209;">int</span><span style="color:#24292E;"> </span><span style="color:#E36209;">r</span><span style="color:#24292E;">, </span><span style="color:#E36209;">int</span><span style="color:#24292E;"> </span><span style="color:#E36209;">g</span><span style="color:#24292E;">, </span><span style="color:#E36209;">int</span><span style="color:#24292E;"> </span><span style="color:#E36209;">b</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> r </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.29889531</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> g </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.58662247</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> b </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.11448223</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> double </span><span style="color:#6F42C1;">rgb2i</span><span style="color:#24292E;">(</span><span style="color:#E36209;">int</span><span style="color:#24292E;"> </span><span style="color:#E36209;">r</span><span style="color:#24292E;">, </span><span style="color:#E36209;">int</span><span style="color:#24292E;"> </span><span style="color:#E36209;">g</span><span style="color:#24292E;">, </span><span style="color:#E36209;">int</span><span style="color:#24292E;"> </span><span style="color:#E36209;">b</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> r </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.59597799</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> g </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.27417610</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> b </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.32180189</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> double </span><span style="color:#6F42C1;">rgb2q</span><span style="color:#24292E;">(</span><span style="color:#E36209;">int</span><span style="color:#24292E;"> </span><span style="color:#E36209;">r</span><span style="color:#24292E;">, </span><span style="color:#E36209;">int</span><span style="color:#24292E;"> </span><span style="color:#E36209;">g</span><span style="color:#24292E;">, </span><span style="color:#E36209;">int</span><span style="color:#24292E;"> </span><span style="color:#E36209;">b</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> r </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.21147017</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> g </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.52261711</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> b </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.31114694</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 像素匹配上绘制灰色</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> int </span><span style="color:#6F42C1;">greyPixel</span><span style="color:#24292E;">(</span><span style="color:#E36209;">int</span><span style="color:#24292E;"> </span><span style="color:#E36209;">rgb1</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 对整数直接进行计算得到rgb值</span></span>
<span class="line"><span style="color:#24292E;">        int r1 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (rgb1 </span><span style="color:#D73A49;">&gt;&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0xff</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        int g1 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (rgb1 </span><span style="color:#D73A49;">&gt;&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0xff</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        int b1 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> rgb1 </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0xff</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        int y </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (int) </span><span style="color:#6F42C1;">rgb2y</span><span style="color:#24292E;">(r1, g1, b1);</span></span>
<span class="line"><span style="color:#24292E;">        int gray </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (int) (</span><span style="color:#005CC5;">255</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> (y </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">255</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.2</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> gray </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0x00ff0000</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> gray </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0x0000ff00</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> gray </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0x000000ff</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0xff000000</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h3 id="其他常用操作" tabindex="-1">其他常用操作 <a class="header-anchor" href="#其他常用操作" aria-label="Permalink to &quot;其他常用操作&quot;">​</a></h3><ul><li>下拉选择框：selectOpion</li><li>文件上传：setInputFiles、单个文件、多个文件、拖放上传</li><li>鼠标点击：mouse().click、mouse().dblclick</li><li>鼠标拖动：mouse().down、mouse().up</li><li>鼠标移动：mouse().move</li><li>键盘按键：press</li><li>截屏、录屏：screenshot、video</li><li>浏览器滚动条滚动到元素位置：querySelector(element).scrollIntoViewIfNeeded()</li></ul><h2 id="代码实战" tabindex="-1">代码实战 <a class="header-anchor" href="#代码实战" aria-label="Permalink to &quot;代码实战&quot;">​</a></h2><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@description</span><span style="color:#6A737D;">: 测试权限控制功能对订阅计划中的内容是否生效</span></span>
<span class="line"><span style="color:#6A737D;"> * @date: 2021-12-29 18:33</span></span>
<span class="line"><span style="color:#6A737D;"> **/</span></span>
<span class="line"><span style="color:#E1E4E8;">public </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">SubscriptionReadTest</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">UiAbstract</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    String </span><span style="color:#FFAB70;">description</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;订阅-查看&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 测试类前实例化page对象</span></span>
<span class="line"><span style="color:#E1E4E8;">    @BeforeTest</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">beforeTest</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// Open new page</span></span>
<span class="line"><span style="color:#E1E4E8;">        page </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> context.</span><span style="color:#B392F0;">newPage</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#B392F0;">Test</span><span style="color:#E1E4E8;">(dataProvider </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;datapro&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">subscriptionReadTest</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">String</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">role</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">String</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">loginId</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.</span><span style="color:#B392F0;">navigate</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;/auth/index&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 输入域名、账号、密码点击登录</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;[placeholder=</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">公司域</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">]&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.</span><span style="color:#B392F0;">fill</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;[placeholder=</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">公司域</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">]&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;rbac&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;[placeholder=</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">邮箱地址</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">]&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.</span><span style="color:#B392F0;">fill</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;[placeholder=</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">邮箱地址</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">]&quot;</span><span style="color:#E1E4E8;">, loginId);</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;[placeholder=</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">密码</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">]&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.</span><span style="color:#B392F0;">fill</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;[placeholder=</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">密码</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">]&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;******&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.</span><span style="color:#B392F0;">waitForNavigation</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            page.click(</span><span style="color:#9ECBFF;">&quot;#loginBtn&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 点击九宫格按钮</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.click(</span><span style="color:#9ECBFF;">&quot;:nth-match(i, 2)&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 点击订阅计划，根据元素截图</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.click(</span><span style="color:#9ECBFF;">&quot;text=订阅计划&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.waitForSelector(</span><span style="color:#9ECBFF;">&quot;text=1&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        ScreenshotUtil.screenshotBySelector(page, </span><span style="color:#9ECBFF;">&quot;div[class=&#39;_1HjXw1zf&#39;]&quot;</span><span style="color:#E1E4E8;">, description+</span><span style="color:#9ECBFF;">&#39;-&#39;</span><span style="color:#E1E4E8;">+role+</span><span style="color:#9ECBFF;">&quot;卡片订阅&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 点击合并订阅，根据元素截图</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.click(</span><span style="color:#9ECBFF;">&quot;text=合并订阅&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.waitForSelector(</span><span style="color:#9ECBFF;">&quot;text=暂无相关数据&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        ScreenshotUtil.screenshotBySelector(page, </span><span style="color:#9ECBFF;">&quot;div[class=&#39;_1HjXw1zf&#39;]&quot;</span><span style="color:#E1E4E8;">, description+</span><span style="color:#9ECBFF;">&#39;-&#39;</span><span style="color:#E1E4E8;">+role+</span><span style="color:#9ECBFF;">&quot;合并订阅&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 点击页面订阅，根据元素截图</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.click(</span><span style="color:#9ECBFF;">&quot;text=页面订阅&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.waitForSelector(</span><span style="color:#9ECBFF;">&quot;text=1&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        ScreenshotUtil.screenshotBySelector(page, </span><span style="color:#9ECBFF;">&quot;div[class=&#39;_1HjXw1zf&#39;]&quot;</span><span style="color:#E1E4E8;">, description+</span><span style="color:#9ECBFF;">&#39;-&#39;</span><span style="color:#E1E4E8;">+role+</span><span style="color:#9ECBFF;">&quot;页面订阅&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 点击数据集订阅，根据元素截图</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.click(</span><span style="color:#9ECBFF;">&quot;text=数据集订阅&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.waitForSelector(</span><span style="color:#9ECBFF;">&quot;text=暂无相关数据&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        ScreenshotUtil.screenshotBySelector(page, </span><span style="color:#9ECBFF;">&quot;div[class=&#39;_1HjXw1zf&#39;]&quot;</span><span style="color:#E1E4E8;">, description+</span><span style="color:#9ECBFF;">&#39;-&#39;</span><span style="color:#E1E4E8;">+role+</span><span style="color:#9ECBFF;">&quot;数据集订阅&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 对上述的测试截图进行断言</span></span>
<span class="line"><span style="color:#E1E4E8;">        ScreenshotUtil.ScreenshotAssert(description+</span><span style="color:#9ECBFF;">&#39;-&#39;</span><span style="color:#E1E4E8;">+role+</span><span style="color:#9ECBFF;">&quot;卡片订阅&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        ScreenshotUtil.ScreenshotAssert(description+</span><span style="color:#9ECBFF;">&#39;-&#39;</span><span style="color:#E1E4E8;">+role+</span><span style="color:#9ECBFF;">&quot;合并订阅&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        ScreenshotUtil.ScreenshotAssert(description+</span><span style="color:#9ECBFF;">&#39;-&#39;</span><span style="color:#E1E4E8;">+role+</span><span style="color:#9ECBFF;">&quot;页面订阅&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        ScreenshotUtil.ScreenshotAssert(description+</span><span style="color:#9ECBFF;">&#39;-&#39;</span><span style="color:#E1E4E8;">+role+</span><span style="color:#9ECBFF;">&quot;数据集订阅&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 测试数据</span></span>
<span class="line"><span style="color:#E1E4E8;">    @DataProvider</span></span>
<span class="line"><span style="color:#E1E4E8;">    public Object[][] datapro() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        return new Object[][]{</span></span>
<span class="line"><span style="color:#E1E4E8;">                {</span><span style="color:#9ECBFF;">&quot;普通用户&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;editor@subscription.read&quot;</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">                {</span><span style="color:#9ECBFF;">&quot;只读用户&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;participant@subscription.read&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">        };</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 测试完成后关闭page</span></span>
<span class="line"><span style="color:#E1E4E8;">    @AfterTest</span></span>
<span class="line"><span style="color:#E1E4E8;">    public </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">after</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// Close page</span></span>
<span class="line"><span style="color:#E1E4E8;">        page.close();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@description</span><span style="color:#6A737D;">: 测试权限控制功能对订阅计划中的内容是否生效</span></span>
<span class="line"><span style="color:#6A737D;"> * @date: 2021-12-29 18:33</span></span>
<span class="line"><span style="color:#6A737D;"> **/</span></span>
<span class="line"><span style="color:#24292E;">public </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">SubscriptionReadTest</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UiAbstract</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    String </span><span style="color:#E36209;">description</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;订阅-查看&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 测试类前实例化page对象</span></span>
<span class="line"><span style="color:#24292E;">    @BeforeTest</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">beforeTest</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// Open new page</span></span>
<span class="line"><span style="color:#24292E;">        page </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> context.</span><span style="color:#6F42C1;">newPage</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#6F42C1;">Test</span><span style="color:#24292E;">(dataProvider </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;datapro&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">subscriptionReadTest</span><span style="color:#24292E;">(</span><span style="color:#E36209;">String</span><span style="color:#24292E;"> </span><span style="color:#E36209;">role</span><span style="color:#24292E;">, </span><span style="color:#E36209;">String</span><span style="color:#24292E;"> </span><span style="color:#E36209;">loginId</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        page.</span><span style="color:#6F42C1;">navigate</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/auth/index&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 输入域名、账号、密码点击登录</span></span>
<span class="line"><span style="color:#24292E;">        page.</span><span style="color:#6F42C1;">click</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;[placeholder=</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">公司域</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">]&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        page.</span><span style="color:#6F42C1;">fill</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;[placeholder=</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">公司域</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">]&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;rbac&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        page.</span><span style="color:#6F42C1;">click</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;[placeholder=</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">邮箱地址</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">]&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        page.</span><span style="color:#6F42C1;">fill</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;[placeholder=</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">邮箱地址</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">]&quot;</span><span style="color:#24292E;">, loginId);</span></span>
<span class="line"><span style="color:#24292E;">        page.</span><span style="color:#6F42C1;">click</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;[placeholder=</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">密码</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">]&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        page.</span><span style="color:#6F42C1;">fill</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;[placeholder=</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">密码</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">]&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;******&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        page.</span><span style="color:#6F42C1;">waitForNavigation</span><span style="color:#24292E;">(() </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            page.click(</span><span style="color:#032F62;">&quot;#loginBtn&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 点击九宫格按钮</span></span>
<span class="line"><span style="color:#24292E;">        page.click(</span><span style="color:#032F62;">&quot;:nth-match(i, 2)&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 点击订阅计划，根据元素截图</span></span>
<span class="line"><span style="color:#24292E;">        page.click(</span><span style="color:#032F62;">&quot;text=订阅计划&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        page.waitForSelector(</span><span style="color:#032F62;">&quot;text=1&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        ScreenshotUtil.screenshotBySelector(page, </span><span style="color:#032F62;">&quot;div[class=&#39;_1HjXw1zf&#39;]&quot;</span><span style="color:#24292E;">, description+</span><span style="color:#032F62;">&#39;-&#39;</span><span style="color:#24292E;">+role+</span><span style="color:#032F62;">&quot;卡片订阅&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 点击合并订阅，根据元素截图</span></span>
<span class="line"><span style="color:#24292E;">        page.click(</span><span style="color:#032F62;">&quot;text=合并订阅&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        page.waitForSelector(</span><span style="color:#032F62;">&quot;text=暂无相关数据&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        ScreenshotUtil.screenshotBySelector(page, </span><span style="color:#032F62;">&quot;div[class=&#39;_1HjXw1zf&#39;]&quot;</span><span style="color:#24292E;">, description+</span><span style="color:#032F62;">&#39;-&#39;</span><span style="color:#24292E;">+role+</span><span style="color:#032F62;">&quot;合并订阅&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 点击页面订阅，根据元素截图</span></span>
<span class="line"><span style="color:#24292E;">        page.click(</span><span style="color:#032F62;">&quot;text=页面订阅&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        page.waitForSelector(</span><span style="color:#032F62;">&quot;text=1&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        ScreenshotUtil.screenshotBySelector(page, </span><span style="color:#032F62;">&quot;div[class=&#39;_1HjXw1zf&#39;]&quot;</span><span style="color:#24292E;">, description+</span><span style="color:#032F62;">&#39;-&#39;</span><span style="color:#24292E;">+role+</span><span style="color:#032F62;">&quot;页面订阅&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 点击数据集订阅，根据元素截图</span></span>
<span class="line"><span style="color:#24292E;">        page.click(</span><span style="color:#032F62;">&quot;text=数据集订阅&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        page.waitForSelector(</span><span style="color:#032F62;">&quot;text=暂无相关数据&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        ScreenshotUtil.screenshotBySelector(page, </span><span style="color:#032F62;">&quot;div[class=&#39;_1HjXw1zf&#39;]&quot;</span><span style="color:#24292E;">, description+</span><span style="color:#032F62;">&#39;-&#39;</span><span style="color:#24292E;">+role+</span><span style="color:#032F62;">&quot;数据集订阅&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 对上述的测试截图进行断言</span></span>
<span class="line"><span style="color:#24292E;">        ScreenshotUtil.ScreenshotAssert(description+</span><span style="color:#032F62;">&#39;-&#39;</span><span style="color:#24292E;">+role+</span><span style="color:#032F62;">&quot;卡片订阅&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        ScreenshotUtil.ScreenshotAssert(description+</span><span style="color:#032F62;">&#39;-&#39;</span><span style="color:#24292E;">+role+</span><span style="color:#032F62;">&quot;合并订阅&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        ScreenshotUtil.ScreenshotAssert(description+</span><span style="color:#032F62;">&#39;-&#39;</span><span style="color:#24292E;">+role+</span><span style="color:#032F62;">&quot;页面订阅&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        ScreenshotUtil.ScreenshotAssert(description+</span><span style="color:#032F62;">&#39;-&#39;</span><span style="color:#24292E;">+role+</span><span style="color:#032F62;">&quot;数据集订阅&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 测试数据</span></span>
<span class="line"><span style="color:#24292E;">    @DataProvider</span></span>
<span class="line"><span style="color:#24292E;">    public Object[][] datapro() {</span></span>
<span class="line"><span style="color:#24292E;">        return new Object[][]{</span></span>
<span class="line"><span style="color:#24292E;">                {</span><span style="color:#032F62;">&quot;普通用户&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;editor@subscription.read&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">                {</span><span style="color:#032F62;">&quot;只读用户&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;participant@subscription.read&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">        };</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 测试完成后关闭page</span></span>
<span class="line"><span style="color:#24292E;">    @AfterTest</span></span>
<span class="line"><span style="color:#24292E;">    public </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">after</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// Close page</span></span>
<span class="line"><span style="color:#24292E;">        page.close();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h2 id="其他资料" tabindex="-1">其他资料 <a class="header-anchor" href="#其他资料" aria-label="Permalink to &quot;其他资料&quot;">​</a></h2><ul><li><a href="https://playwright.dev/java/docs/intro" target="_blank" rel="noreferrer">官网文档</a></li><li><a href="https://github.com/microsoft/playwright-java" target="_blank" rel="noreferrer">GitHub</a></li></ul>`,41),t=[e];function c(r,E,y,i,F,u){return n(),a("div",null,t)}const B=s(o,[["render",c]]);export{C as __pageData,B as default};
